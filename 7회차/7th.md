# 강의 교안 7

<hr>

### 클러스터의 최적의 Shard 설정 결정
* 검색엔진으로서의 ES
  * 검색 엔진 서비스는 응답 속도가 생명
  * 대형 검색 서비스의 검색엔진 서비스 구조 = 문서 웹 크롤러 -> 데이터 스토어 -> 검색엔진 인덱싱 -> 서비스
  * ES 같이 가벼운 검색엔진은 인덱싱과 검색이 공존하는 게 일반적 (Near-Real Time Search Engine) `준 실시간 검색엔진`을 구성하여 서비스
* 준 실시간 검색엔진 구성의 시나리오
  1. 데이터는 검색이 이뤄지는 순간에도 계속 인덱싱 된다.
  2. 쿼리는 인덱스의 전체 문서를 요구할 만큼 무거운 쿼리가 들어올 수 있다.
  3. 검색 엔진의 생명은 응답속도이다. 응답 속도는 200 milliseconds 이하가 나와야 한다.
  4. 검색 서비스에 사용할 인덱스의 사이즈는 200G 이다.
  5. 데이터는 일 단위로 교체가 필요하다. 그 날 만들어진 인덱스는 23:59까지만 서비스하고 다음 날 만들어진 인덱스는 00:00 부터 서비스한다.
  5-a. 다음 날 인덱스를 미리 만들어 둘 수 있는 경우 
  5-b. 당일 인덱스를 만들어야하는 경우
  6. 클러스터는 데이터의 성격 혹은 사용 패턴이 다르다 나의 환경에 가장 적합한 샤드의 사이즈를 찾아야 한다.
* 준 실시간 검색엔진 구성 최적화 과정
  1. 데이터는 검색이 이뤄지는 순간에도 계속 인덱싱 된다
    -> 위 환경이 갖춰진 이후에 실제 서비스할 데이터를 지속적으로 색인한다
  2. 쿼리는 인덱스의 전체 문서를 요구할 만큼 무거운 쿼리가 들어올 수 있다
    -> 실사용 쿼리 중 가장 무거운 쿼리를 검색 쿼리로 활용
  3. 검색 엔진의 생명은 응답속도이다. 응답 속도는 200 ms 이하가 나와야 한다
    -> 1번\~2번 과정을 반복하며 응답속도 확인 
    -> 200 ms 에 도달하는 순간 1번\~2번 중단
  4. 검색 서비스에 사용할 인덱스의 사이즈는 200G 이다
    -> 단일 인덱스이기 때문에 인덱스의 사이즈가 곧 샤드의 사이즈 
    -> 200G / {테스트 인덱스 사이즈} = 샤드의 개수
  5. 데이터는 일 단위로 교체가 필요하다. 그 날 만들어진 인덱스는 23:59 까지만 서비스하고 다음 날 만들어진 인덱스는 00:00 부터 서비스한다.
    -> alias 기능을 이용
  5-a. 다음 날 인덱스를 미리 만들어 둘 수 있는 경우
    -> 인덱스를 미리 만들고 alias 를 조정
  5-b. 당일 인덱스를 만들어야하는 경우
    -> 인덱스를 만들면서 alias 를 조정
